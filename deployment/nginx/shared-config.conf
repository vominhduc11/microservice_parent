# Shared Nginx Configuration for 4thitek.vn infrastructure
#
# DEPLOYMENT:
# Deploy this file to: /etc/nginx/conf.d/shared-config.conf
# Command: sudo cp shared-config.conf /etc/nginx/conf.d/
#
# IMPORTANT:
# - This file MUST be in /etc/nginx/conf.d/ (NOT /etc/nginx/)
# - Nginx auto-loads files in conf.d/ once
# - DO NOT include this file in site configs
# - If included in site configs, you'll get duplicate limit_req_zone errors
#
# Rate Limiting Zones
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=general_limit:10m rate=30r/s;

# Upstream definitions (optional, for load balancing in future)
upstream api_backend {
    server 127.0.0.1:8080 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

upstream main_frontend {
    server 127.0.0.1:3000 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

upstream admin_frontend {
    server 127.0.0.1:9000 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

upstream dealer_frontend {
    server 127.0.0.1:5173 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

upstream notification_ws {
    server 127.0.0.1:8087 max_fails=3 fail_timeout=30s;
    keepalive 32;
}
